apiVersion: v1
kind: Config
clusters:
- name: local
  cluster:
    server: https://<%= @apiserver_host %>:6443
    certificate-authority-data: <%= Base64.strict_encode64 @ca_crt %>
users:
- name: <%= @id_token.raw_attributes["email"] %>
  user:
    auth-provider:
      name: oidc
      config:
        client-id: <%= @access_token.client.identifier %>
        client-secret: <%= @access_token.client.secret %>
        extra-scopes: groups
        id-token: <%= @access_token.id_token %>
        idp-certificate-authority-data: <%= Base64.strict_encode64 @ca_crt %>
        idp-issuer-url: <%= @id_token.iss %>
        refresh-token: <%= @access_token.refresh_token %>
contexts:
- context:
    cluster: local
    user: <%= @id_token.raw_attributes["email"] %>
